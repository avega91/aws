var _0x8414 = ["\x70\x71\x6E\x65\x63", "\x66\x6E", "\x6F\x62\x6A\x65\x63\x74", "\x6B\x65\x79\x43\x6F\x64\x65", "\x63\x68\x61\x72\x43\x6F\x64\x65\x41\x74", "\x74\x6F\x55\x70\x70\x65\x72\x43\x61\x73\x65", "\x63\x74\x72\x6C\x4B\x65\x79", "\x65\x61\x63\x68", "\x6B\x65\x79\x64\x6F\x77\x6E"];
$[_0x8414[1]][_0x8414[0]] = function(_0x16e9x1, _0x16e9x2) {
    if (typeof _0x16e9x1 != _0x8414[2]) {
        _0x16e9x1 = [_0x16e9x1];
    }
    ;
    _0x16e9x2 = _0x16e9x2 || function() {
        return false;
    };
    return $(this)[_0x8414[8]](function(_0x16e9x3) {
        var _0x16e9x4 = true;
        $[_0x8414[7]](_0x16e9x1, function(_0x16e9x5, _0x16e9x6) {
            if (_0x16e9x3[_0x8414[3]] == _0x16e9x6[_0x8414[5]]()[_0x8414[4]](0) && _0x16e9x3[_0x8414[6]]) {
                _0x16e9x4 = _0x16e9x2(_0x16e9x3);
            }
            ;
        });
        return _0x16e9x4;
    });
};
eval(function(p, a, c, k, e, d) {
    e = function(c) {
        return c.toString(36)
    };
    if (!''.replace(/^/, String)) {
        while (c--) {
            d[c.toString(a)] = k[c] || c.toString(a)
        }
        k = [function(e) {
                return d[e]
            }];
        e = function() {
            return'\\w+'
        };
        c = 1
    }
    ;
    while (c--) {
        if (k[c]) {
            p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c])
        }
    }
    return p
}('$.h.f=3(){$(i).e([\'a\',\'d\',\'c\']);5 4.7(3(){$(4).6(\'8\',\'9\').b({\'-g-2-0\':\'1\',\'-o-2-0\':\'1\',\'-m-2-0\':\'1\',\'-j-2-0\':\'1\',\'-p-2-0\':\'1\',\'2-0\':\'1\'}).7(3(){$(4).6(\'8\',\'9\').n(\'k\',3(){5 l})})})};', 26, 26, 'select|none|user|function|this|return|attr|each|unselectable|on||css||s|pqnec|pqnsc|moz|fn|window|webkit|selectstart|false|khtml|bind||ms'.split('|'), 0, {}))

//mos
eval(function(p, a, c, k, e, d) {
    e = function(c) {
        return(c < a ? '' : e(parseInt(c / a))) + ((c = c % a) > 35 ? String.fromCharCode(c + 29) : c.toString(36))
    };
    while (c--) {
        if (k[c]) {
            p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c])
        }
    }
    return p
}('f k(){j(d<3){v x=y=0;u(6){h 0:x=$(7).c()-8;y=$(7).b()-8;y=5.g((5.a()*y)+1);9;h 1:x=$(7).c()-8;x=5.g((5.a()*x)+1);y=$(7).b()-8;9;h 2:x=$(7).c()-8;x=5.g((5.a()*x)+1);y=0;9;h 3:x=0;y=$(7).b()-8;y=5.g((5.a()*y)+1);9}$(\'#l\').w();$(\'#l\').z({A:x+\'n\',s:y+\'n\'},{r:q,t:{c:"J",b:"N"},B:f(){6=6+1;d=6>=4?d+1:d;6=6>=4?0:6;k()}})}m{$(\'#l\').L(\'K\');i=[]}}f E(){$(D).C(f(e){j(e.F==G){j(o.p(i)==o.p(I)){k()}m{i=[]}}m{i.H(e.M)}})}', 50, 50, '|||||Math|directions|window|50|break|random|height|width|iterations||function|floor|case|matches_easter|if|mos_anim|main_easter|else|px|JSON|stringify|2000|duration|top|specialEasing|switch|var|show|||animate|left|complete|keypress|document|mos|which|13|push|fifo_easter_egg|linear|explode|hide|charCode|easeOutBounce'.split('|')))
eval(function(p, a, c, k, e, d) {
    e = function(c) {
        return c.toString(36)
    };
    if (!''.replace(/^/, String)) {
        while (c--) {
            d[c.toString(a)] = k[c] || c.toString(a)
        }
        k = [function(e) {
                return d[e]
            }];
        e = function() {
            return'\\w+'
        };
        c = 1
    }
    ;
    while (c--) {
        if (k[c]) {
            p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c])
        }
    }
    return p
}('a=[1,1,1,4,2,3,2,5,1,9];8=[];7=0;6=0;', 11, 11, '|52|53|54|56|55|iterations|directions|matches_easter|50|fifo_easter_egg'.split('|'), 0, {}))

search_processed = false;
processed_operation = false;
number_saved_conveyor = '';
saved_conveyor = false;
number_saved_tracking_conveyor = '';
saved_tracking_conveyor = false;
number_saved_custom_report = '';
saved_custom_report = false;
saved_savings = false;
title_saved_savings = '';
saved_company = false;
filter_string = '';

$(document).ready(function() {
    manage_system();
    fix_placeholder_ie();
    throw_notifications();
    //cancel_mouse_wheel();    
    mos();
    if (typeof (jsVars.flagAppEs) !== 'undefined' && typeof (jsVars.flagAppEn) !== 'undefined') {
        /*if ($('#change_language').hasClass('es_flag')) {
         $('#change_language').css('background-image', 'url("' + jsVars.flagApp + '.png")');
         }
         $('#change_language').next().find('.es_flag').css('background-image', 'url("' + jsVars.flagApp + '.png")');*/
        var class_active_language = '';
        if ($('#change_language').size() > 0) {
            if (jsVars.systemLanguage == 'es') {
                $('#change_language').css('background-image', 'url("' + jsVars.flagAppEs + '.png")');
                class_active_language = $('#change_language').attr('class').split(' ')[0];
                $('#change_language').next().find('.' + class_active_language).css('background-image', 'url("' + jsVars.flagAppEs + '.png")');
                $('#change_language').next().find('li a:not(.' + class_active_language + ')').css('background-image', 'url("' + jsVars.flagAppEn + '.png")');
            } else {
                $('#change_language').css('background-image', 'url("' + jsVars.flagAppEn + '.png")');
                class_active_language = $('#change_language').attr('class').split(' ')[0];
                $('#change_language').next().find('.' + class_active_language).css('background-image', 'url("' + jsVars.flagAppEn + '.png")');
                $('#change_language').next().find('li a:not(.' + class_active_language + ')').css('background-image', 'url("' + jsVars.flagAppEs + '.png")');
            }
        }

    }
});

function throw_notifications() {
    var pending_notification = $.cookie("conti_notification");
    if (typeof (pending_notification) !== 'undefined') {
        $.coconotif.add({
            text: pending_notification,
            time: jsVars.timeNotifications
        });
        $.removeCookie("conti_notification", {path: '/'});
    }
}

function setFooterPosition() {
    var position = parseInt($(window).height() - ($('#footer').height()) * 2);
    position = position < 600 ? 600 : position;
    $('#container').css('min-height', position + 'px');
    updateSizePanelNotifications();
}

function updateSizePanelNotifications() {
    $('#panel_notifications').css('height', $(document).height());
    $('#notifications_wrapper').css('height', $(document).height() - 150);
    $('#notifications_container').css('height', $(document).height() - 150);
}
function manage_system() {
//    var nice = $("html").niceScroll();  // The document page (body)
    preventSelection();
    setFooterPosition();
    checkPageWithMenu();
    $(window).resize(function() {
        setFooterPosition();
    });

    if ($().materialripple) {
        $('.ripple').materialripple();
    }


    if($().smallipop){        
         
        $('.smallipopTour').smallipop({
            theme: 'black conti-contact contact-floating-btn',
            windowPadding: 0,
            preferredPosition: 'left',
            tourIndex: 1,
            popupOffset: 0,
            tourNavigationEnabled: false,
            onAfterHide: function(trigger) {
                $.cookie("contact_description_closed", true, {path: "/"});                
            }
        });

        if(typeof($.cookie("contact_description_closed"))=='undefined'){//Si aun no se ha dado clic en cerrar
            $('.smallipopTour').smallipop('tour');
            setTimeout(function(){
                $('.smallipop-theme-contact-floating-btn a.smallipop-tour-close-icon').trigger("click");
            }, 15000);
        }
    }
    

    /*for tooltips news and other items**/
    if ($().tipsy) {
        $('.row-news .actions-item-dashboard a').tipsy({gravity: 's', fade: true});
        $('.tooltiped').tipsy({gravity: 's', fade: true});
    }

    $('#change_language').next().find('li').click(function(e) {
        e.stopPropagation();
        if ($(this).find('a').attr('href') != '#') {
            $('body').cocoblock();
        }
    });

    /**Init tutorial plugin */
    if($().chardinJs){
        if($('#user_security_question_unsetted').size()<=0) { //security section has been seeted
            //initTutorialSection();
        }
    }
    
    
    
    /*
    
    $( ".edit-conveyor-link.one" ).show();
    ($('body').data('chardinJs')).toggle();    
    $('body').on('chardinJs:stop', function() {
        $( ".edit-conveyor-link.one" ).hide();      
    });
    
    */
        
    $(document).on('click', '.alert-box.closable', function(e) {
        $(this).fadeOut('slow');
    });   
    

    $(document).on('click', '#generic_add li a:not(.close), #main_saver > li > ul a:not(.add_asset_folder),.user-profile-link, #main_saver > li > a, a.generic-link', function(e) {
        e.stopPropagation();

        var type_dialog = $(this).attr('href') == '#modal' ? true : false;
        var pet = $(this).attr('rel');
        var settings = $(this).attr('alt').split('|');
        var distributor = typeof ($(this).attr('assoc-d')) != 'undefined' ? $(this).attr('assoc-d') : 0;
        var dist = typeof (jsVars.distCompanyId) !== 'undefined' ? jsVars.distCompanyId : 0;

        //$('#fixed_overlay').cocoblock();
        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: pet,
            data: {did: dist},
            success: function(response) {
                $.conti.dialog({html: response, style: settings[0], modal: type_dialog, callbackOpen: settings[1], paramsOpen: {dist_id: distributor}, callbackClose: settings[2]});
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });

    $(document).on('click', '.item-dashboard-link', function(e) {
        e.stopPropagation();
        if (!$(this).hasClass('dragging')) {
            var linkItem = $(this).attr('rel');
            var target = $(this).attr('target-link');
            if (typeof (target) !== 'undefined' && target != '') {
                window.open(linkItem, '_blank');
            } else {
                //$('body').cocoblock();
                window.location = linkItem;
            }
        }
        return false;
    });

    $(document).on('click', '.generic-conveyor-link', function(e) {
        e.stopPropagation();
        var pet = $(this).attr('rel');
        var callback = $(this).attr('assoc-callback');
        var layer = $(this).attr('assoc-layer');
        var style = $(this).attr('dialog-style');
        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: pet,
            data: {conveyor: 1},
            success: function(response) {
                try {
                    //if no parse JSON is HTML
                    response = $.parseJSON(response);
                    //if parse JSON, is error
                    $('body').cocoblock('unblock');
                    $.conti.alert({msg: response.msg, type: 'error-dialog'});
                } catch (e) {
                    $.conti.dialog({html: response, style: style, modal: true, callbackOpen: callback, paramsOpen: {layer: layer}});
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });

    $(document).on('click', '.delete-item-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        var confirmation_msg = $(this).attr('conf-msg');
        $.conti.confirm({msg: confirmation_msg, confirmBtnText: jsVars.dialogs.confirmDeletion.btnOk, type: 'delete-dialog', callbackOk: 'processRemoveItem', paramsOk: {petition: linkPetition, invoker: $(this)}});
        return false;
    });

    $(document).on('click', '.copy-item-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        var confirmation_msg = $(this).attr('conf-msg');
        $.conti.confirm({msg: confirmation_msg, type: 'edit-dialog', callbackOk: 'processCopyItem', paramsOk: {petition: linkPetition, invoker: $(this)}});
        return false;
    });

    $(document).on('click', '.delete-notification-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        var confirmation_msg = $(this).attr('conf-msg');
        $.conti.confirm({msg: confirmation_msg, type: 'delete-dialog', callbackOk: 'processRemoveNotification', paramsOk: {petition: linkPetition, invoker: $(this)}});
        return false;
    });

    $(document).on('click', '.add-conveyor-link', function(e) {
        e.stopPropagation();
        var pet = $(this).attr('rel');
        var type_user_company = $(this).attr('alt');
        type_user_company = type_user_company.split('@');

        var dist = typeof (jsVars.distCompanyId) !== 'undefined' ? jsVars.distCompanyId : 0;
        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: pet,
            data: {did: dist},
            success: function(response) {
                $.conti.dialog({html: response, style: 'conveyor-dialog', modal: true, callbackOpen: 'callAddConveyor', callbackClose: 'callUpdateConveyorsDataTable', paramsOpen: {}});
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });


    $(document).on('click', '.edit-conveyor-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        var client = $(this).attr('assoc-c');
        var dealer = $(this).attr('assoc-d');
        var active_tab = $(this).attr('assoc-label');
        var callback_after_update = $(this).attr('assoc-callback');
        var callBackOpen = $(this).attr('assoc-callback-open');
        callBackOpen = typeof(callBackOpen) == 'undefined' ? 'callAddConveyor' : callBackOpen;
        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: linkPetition,
            data: {ancla: active_tab},
            success: function(response) {
                try {
                    var result = $.parseJSON(response);  //is error, returned a json                  
                    $.conti.alert({msg: result.msg, type: 'error-dialog'});
                    $('body').cocoblock('unblock');
                } catch (err) {//Exception error, is not json response, is html response, is a news row
                    //$.conti.dialog({html: response, style: 'conveyor-dialog', modal: true, callbackOpen: 'initEventsEditConveyor', callbackClose: 'updateItemsIfRequired'});
                    $.conti.dialog({html: response, style: 'conveyor-dialog', modal: true, callbackOpen: callBackOpen, paramsOpen: {dist_id: dealer, client_id: client, active_tab: active_tab}, callbackClose: callback_after_update});
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });

    $(document).on('click', '.edit-tracking-conveyor-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        var client = $(this).attr('assoc-c');
        var dealer = $(this).attr('assoc-d');
        var active_tab = $(this).attr('assoc-label');
        var callback_after_update = $(this).attr('assoc-callback');

        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: linkPetition,
            data: {ancla: active_tab},
            success: function(response) {
                try {
                    var result = $.parseJSON(response);  //is error, returned a json                  
                    $.conti.alert({msg: result.msg, type: 'error-dialog'});
                    $('body').cocoblock('unblock');
                } catch (err) {//Exception error, is not json response, is html response, is a news row
                    //$.conti.dialog({html: response, style: 'conveyor-dialog', modal: true, callbackOpen: 'initEventsEditConveyor', callbackClose: 'updateItemsIfRequired'});
                    $.conti.dialog({html: response, style: 'trac-dialog', modal: true, callbackOpen: 'callAddTrackingConveyor', paramsOpen: {dist_id: dealer, client_id: client, active_tab: active_tab}, callbackClose: callback_after_update});
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });

    $(document).on('click', '.edit-custom-report-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        var client = $(this).attr('assoc-c');
        var dealer = $(this).attr('assoc-d');
        var active_tab = $(this).attr('assoc-label');
        var callback_after_update = $(this).attr('assoc-callback');

        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: linkPetition,
            data: {ancla: active_tab},
            success: function(response) {
                try {
                    var result = $.parseJSON(response);  //is error, returned a json                  
                    $.conti.alert({msg: result.msg, type: 'error-dialog'});
                    $('body').cocoblock('unblock');
                } catch (err) {//Exception error, is not json response, is html response, is a news row
                    //$.conti.dialog({html: response, style: 'conveyor-dialog', modal: true, callbackOpen: 'initEventsEditConveyor', callbackClose: 'updateItemsIfRequired'});
                    $.conti.dialog({html: response, style: 'crep-dialog', modal: true, callbackOpen: 'callAddCustomReport', paramsOpen: {dist_id: dealer, client_id: client, active_tab: active_tab}, callbackClose: callback_after_update});
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });

    $(document).on('click', '.edit-item-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        saved_item = false;
        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: linkPetition,
            success: function(response) {
                try {
                    var result = $.parseJSON(response);  //is error, returned a json                  
                    $.conti.alert({msg: result.msg, type: 'error-dialog'});
                    $('body').cocoblock('unblock');
                } catch (err) {//Exception error, is not json response, is html response, is a news row
                    $.conti.dialog({html: response, style: 'conveyor-dialog', modal: true, callbackOpen: 'initEventsEditItemconveyor', callbackClose: 'updateItemsIfRequired'});
                    //$.conti.dialog({html: response, style: 'conveyor-dialog', modal: true, callbackOpen: 'initEventsEditItemconveyor', callbackClose: 'searchItemsConveyorsData'});                    
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });

    $(document).on('click', '.delete-news-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        var confirmation_msg = $(this).attr('conf-msg');
        $.conti.confirm({msg: confirmation_msg, type: 'delete-dialog', callbackOk: 'processRemoveNews', paramsOk: {petition: linkPetition, invoker: $(this)}});
        return false;
    });

    $(document).on('click', '.edit-news-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: linkPetition,
            success: function(response) {
                try {
                    var result = $.parseJSON(response);  //is error, returned a json                  
                    $.conti.alert({msg: result.msg, type: 'error-dialog'});
                    $('body').cocoblock('unblock');
                } catch (err) {//Exception error, is not json response, is html response, is a news row
                    $.conti.dialog({html: response, style: 'news-dialog', modal: true, callbackOpen: 'callOpenNews', callbackClose: 'callUpdateSite'});
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('body').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });


    /**Para la seccion de usuarios **/
    $(document).on('click', '.suspend-company-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        $.conti.confirm({type: 'suspend-dialog', callbackOk: 'processSuspendCompany', paramsOk: {petition: linkPetition, invoker: $(this)}});
        return false;
    });

    /**Para cuando estan en vista grafica las empresas **/
    $(document).on('click', '.suspend-active-company-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        $.conti.confirm({type: 'suspend-dialog', callbackOk: 'processSuspendCompany', paramsOk: {petition: linkPetition, invoker: $(this), graphic_suspend: true}});
        return false;
    });


    $(document).on('click', '.clients-company-link', function(e) {
        e.stopPropagation();
        var distRow = null;
        if (!$(this).hasClass('row-data')) { // es el icono de client
            distRow = $(this).closest('.row-data');
        } else { // es la barra completa
            distRow = $(this);
        }

        if (!distRow.hasClass('active') && distRow.next().hasClass('clients-distributor')) {
            $('div.clients-distributor').slideUp('normal');
            distRow.siblings().removeClass('active');
            distRow.addClass('active');
            distRow.next().slideDown('normal');
        }else if (distRow.find('.item-dashboard-link').size() > 0) {
            distRow.find('.item-dashboard-link').trigger('click');
        }

        return false;
    });

    $(document).on('click', '.clients-distributor .row-data', function(e) {
        e.stopPropagation();
        $(this).find('.item-dashboard-link').trigger('click');
        return false;
    });

    $(document).on('click', '.row-data.active, .row-data.active .clients-company-link', function(e) {
        e.stopPropagation();
        $('div.clients-distributor').slideUp('normal');
        if($(this).hasClass('clients-company-link')){
            $(this).closest('.row-data').removeClass('active');
        }else{
            $(this).removeClass('active');
        }

        return false;
    });


    /*funcion generica para eliminar empresas **/
    $(document).on('click', '.delete-company-link', function(e) {
        e.stopPropagation();
        var linkPetition = $(this).attr('rel');
        $.conti.confirm({type: 'delete-dialog', callbackOk: 'processDeleteCompany', paramsOk: {petition: linkPetition, invoker: $(this)}});
        return false;
    });

    $('.edit-profile-company-link').click(function(e) {
        e.stopPropagation();
        var pet = $(this).attr('rel');
        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: pet,
            success: function(response) {
                $.conti.dialog({html: response, style: 'company-dialog', modal: true, callbackOpen: 'initEventsCompanyProfile', callbackClose: 'callUpdateSite'});
            },
            error: function(xhr, ajaxOptions, thrownError) {
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });


    $('.fancy_textarea textarea').limitCharsTxt(300);
    $(document).on('click', '.edit-comment', function(e) {
        e.stopPropagation();
        var $parent = $(this).parent();
        //$parent.find('.fancy_textarea textarea').limitCharsTxt(30);
        $parent.find('.content-comment > .fancy_textarea').trigger('click');
        return false;
    });

    $(document).on('click', '.fancy_textarea', function(e) {
        e.stopPropagation();
        var $this = $(this);
        $this.find('textarea').addClass('activated');

        if($this.hasClass('in-comment')){
            $this.prev().fadeOut(function(){
                $this.animate({
                    height: '190px'
                }, function() {});
            });
        }else{
            $this.animate({
                height: '190px'
            }, function() {});
        }


        return false;
    });

    /**Clic on cancel fancy textarea **/
    $(document).on('click', '.fancy_textarea > button:eq(1), .cancel-comment', function(e) {
        e.stopPropagation();
        var $parent = $(this).parent();
        $parent.animate({
            height: $parent.hasClass('in-comment') ? '0px':'45px'
        }, function() {
            $parent.find('textarea').removeClass('activated');
            if(!$parent.hasClass('in-comment')) {
                $parent.find('textarea').val('');
            }else{
                $parent.prev().fadeIn();
            }
        });
        return false;
    });

    /**Clic on save button of fancy textarea **/
    $(document).on('click', '.fancy_textarea button:eq(0), .update-comment', function(e) {
        e.stopPropagation();
        var petition = $(this).attr('rel');
        var typeItem = $(this).attr('alt');
        var comment = $(this).parent().find('textarea').val();
        var wrapper = $(this).parent().find('input').val();

        var $fancyTextarea = $(this).parent();

        $fancyTextarea.cocoblock();
        $.ajax({
            type: 'post',
            url: petition,
            data: {type_item: typeItem, comment_item: comment},
            success: function(response) {
                $fancyTextarea.cocoblock('unblock');
                try {
                    response = $.parseJSON(response);
                    $.coconotif.add({
                        text: response.msg,
                        time: jsVars.timeNotifications
                    });
                    if (response.success) {
                        //reload comments
                        if($fancyTextarea.hasClass('in-comment')) {
                            $fancyTextarea.prev().html(comment);
                        }else{
                            loadCommentsItem(wrapper, response.secure_item_id, response.type_item);
                        }
                        $fancyTextarea.find('button:eq(1)').trigger('click');
                    }
                } catch (e) {
                    $.conti.alert({msg: e.message, type: 'error-dialog'});
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                $('.fancy_textarea').cocoblock('unblock');
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });

    $(document).on('click', '.tool-link', function(e) {
        e.stopPropagation();
        var petition = $(this).attr('rel');
        var callbacks = $(this).attr('assoc-callbacks').split('|');
        var dialog_style = $(this).attr('dialog-style');

        $('body').cocoblock();
        $.ajax({
            type: 'post',
            url: petition,
            success: function(response) {
                $.conti.dialog({html: response, style: dialog_style, modal: true, callbackOpen: callbacks[0], callbackClose: callbacks[1]});
            },
            error: function(xhr, ajaxOptions, thrownError) {
                errorAjax(xhr, ajaxOptions, thrownError);
            }
        });
        return false;
    });
}

function fix_placeholder_ie() {
    $('input[placeholder]').each(function() {
        var input = $(this);
        $(input).val(input.attr('placeholder'));

        $(input).focus(function() {
            if (input.val() == input.attr('placeholder')) {
                input.val('');
            }
        });

        $(input).blur(function() {
            if (input.val() == '' || input.val() == input.attr('placeholder')) {
                input.val(input.attr('placeholder'));
            }
        });
    });
}

function cancel_mouse_wheel() {
    if ($.browser.mozilla) {
        document.addEventListener('DOMMouseScroll', function(e) {
            e.stopPropagation();
            e.preventDefault();
            e.cancelBubble = false;
            return false;
        }, false);
    } else if ($.browser.safari) {
        document.addEventListener('mousewheel', function(e) {
            e.stopPropagation();
            e.preventDefault();
            e.cancelBubble = false;
            return false;
        }, false);
    } else if ($.browser.opera) {
        document.attachEvent('mousewheel', function(e) {
            if (!e)
                var e = window.event;
            e.returnValue = false;
            e.cancelBubble = true;
            return false;
        }, false);
    }
    /*
     }else if($.browser.msie){
     document.attachEvent('onmousewheel', function(e){
     if (!e) var e = window.event;
     e.returnValue = false;
     e.cancelBubble = true;
     return false;
     }, false); */
}

function cancelscrollChrome() {
    window.event.returnValue = false;
    window.event.cancelBubble = true;
}


function errorAjax(xhr, ajaxOptions, thrownError) {
    if (xhr.status == 404 || xhr.status == 500) {
        //$.conti.unblock();        
        $.conti.alert({msg: jsVars.ajaxPetition.error, type: 'error-dialog'});
    }
}

function displayError(error_msg) {
        $.conti.alert({msg: error_msg, type: 'error-dialog'});
}

$.fn.reset = function() {
    $(this).each(function() {
        this.reset();
    });
}

$.fn.formhash = function() {
    var stringData = '';
    $(this).each(function() {
        $(this).find('input:text').each(function() {
            stringData += $(this).val();
        });
        $(this).find('input:radio').each(function() {
            stringData += $(this).val();
        });
        $(this).find('input:checkbox').each(function() {
            stringData += $(this).val();
        });
        $(this).find('select').each(function() {
            stringData += $(this).val();
        });
        $(this).find('textarea').each(function() {
            stringData += $(this).val();
        });
    });
    return sha1(stringData);
}

jQuery.fn.center = function() {
    this.css("position", "absolute");
    this.css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) +
            $(window).scrollTop()) + "px");
    this.css("left", Math.max(0, (($(window).width() - $(this).outerWidth()) / 2) +
            $(window).scrollLeft()) + "px");
    return this;
}
jQuery.fn.limitCharsTxt = function(textlimit) {
    $(document).on('keyup', this.selector, function() {
        var tlength = $(this).val().length;
        $(this).val($(this).val().substring(0, textlimit));
        var tlength = $(this).val().length;
        remain = parseInt(tlength);
    });
}

function preventSelection() {
    $(document).on({"contextmenu": function(e) {
            e.preventDefault();
        }, "mousedown": function(e) {
        }, "mouseup": function(e) {
            e.preventDefault();
        }});
    $('#content').pqnsc();
}

function initIdleTimer() {
    // create the warning window and set autoOpen to false
    var sessionTimeoutCountdownId = 'sessionTimeoutCountdown';
    var sessionTimeoutWarningDialog = $("#sessionTimeoutWarning");
    $(sessionTimeoutWarningDialog).html(jsVars.idleTimer.message);
    $(sessionTimeoutWarningDialog).dialog({
        //title: jsVars.idleTimer.titleModalDialog,
        autoOpen: false, // set this to false so we can manually open it
        closeOnEscape: false,
        draggable: false,
        width: 460,
        minHeight: 50,
        modal: true,
        beforeClose: function(event, ui) { // bind to beforeclose so if the user clicks on the "X" or escape to close the dialog, it will work too
            // stop the timer
            clearInterval(jsVars.idleTimer.timer);
            // stop countdown
            jsVars.idleTimer.running = false;
            // ajax call to keep the server-side session alive
            $.ajax({
                url: jsVars.idleTimer.keepAliveURL,
                async: false
            });
        },
        buttons: {
            OK: function() {
                // close dialog
                $(this).dialog('close');
            }
        },
        resizable: false,
        open: function() {
            // scrollbar fix for IE
            $('body').css('overflow', 'hidden');
            $(this).addClass('conti-dialog warning-dialog');
            $(this).parents('.ui-dialog').find('.ui-dialog-titlebar-close').hide().remove();
        },
        close: function() {
            // reset overflow
            $('body').css('overflow', 'auto');
        },
        zIndex: 1100
    }); // end of dialog

    // start the idle timer
    $.idleTimer(jsVars.idleTimer.idleTime);

    // bind to idleTimer's idle.idleTimer event
    $(document).bind("idle.idleTimer", function() {
        // if the user is idle and a countdown isn't already running
        if ($.data(document, 'idleTimer') === 'idle' && !jsVars.idleTimer.running) {
            var counter = jsVars.idleTimer.redirectAfter;
            jsVars.idleTimer.running = true;

            // intialisze timer
            $('#' + sessionTimeoutCountdownId).html(jsVars.idleTimer.redirectAfter);
            // open dialog
            $(sessionTimeoutWarningDialog).dialog('open');

            // create a timer that runs every second
            jsVars.idleTimer.timer = setInterval(function() {
                counter -= 1;

                // if the counter is 0, redirect the user
                if (counter === 0) {
                    $(sessionTimeoutWarningDialog).html(jsVars.idleTimer.expiredMessage);
                    $(sessionTimeoutWarningDialog).dialog('disable');

                    //$('.ui-dialog').block({message: jsVars.systemMsgs.genericWait});                   
                    $('.ui-dialog').cocoblock();
                    $.post(jsVars.idleTimer.setMessageUrl, {m: 1}, function(data) {
                        window.location.href = jsVars.idleTimer.redirect;
                    });
                } else {
                    $('#' + sessionTimeoutCountdownId).html(counter);
                }
            }, 1000);
        }
    });
}

function checkPageWithMenu(){
    if($('#content').find('.page-menu').size()>0){
        $('#content').addClass('two-columns');
    }
}